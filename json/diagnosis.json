{
  "openapi": "3.1.0",
  "info": {
    "title": "Avey Diagnostic API",
    "description": "Use our leading symptom checker AI to provide early patient care through differential diagnosis suggestions, self-management advice, specialist recommendation, and a triage assessment of how urgent the patient's presentation is",
    "version": "0.1.0"
  },
  "servers": [
    {
      "url": "http://localhost:8081/ddx",
      "description": "Development"
    }
  ],
  "paths": {
    "/v1/session": {
      "post": {
        "tags": [
          "Converational"
        ],
        "summary": "Create session",
        "description": "Starts a new interactive diagnostic session. Provide the patient's initial information\n    (age, sex, and the input text of the patient) to create a session and receive the first question.\n    A unique `session_id` is returned, which you must use for all subsequent calls.",
        "operationId": "start_session",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StartSessionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/v1/session/{session_id}/next": {
      "post": {
        "tags": [
          "Converational"
        ],
        "summary": "Answer question",
        "description": "Submits an answer to the previous question and retrieves the next one.\n    When the model has enough information, or if the question limit set for the session is reached, the `question` field in the response will be `null`.",
        "operationId": "answer_question",
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "parameters": [
          {
            "name": "session_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "description": "The unique identifier for the session.",
              "examples": [
                "f47ac10b-58cc-4372-a567-0e02b2c3d479"
              ],
              "title": "Session Id"
            },
            "description": "The unique identifier for the session."
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AnswerQuestionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/v1/session/{session_id}/diagnose": {
      "get": {
        "tags": [
          "Converational"
        ],
        "summary": "Get diagnosis",
        "description": "Generates a clinical diagnosis and patient recommendations based on a patient's profile from an existing session.\n    Provides a differential diagnosis, self management adivce, urgency evaluation, and specialist recommendation.",
        "operationId": "diagnose_session",
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "parameters": [
          {
            "name": "session_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "description": "The unique identifier for a completed session.",
              "examples": [
                "f47ac10b-58cc-4372-a567-0e02b2c3d479"
              ],
              "title": "Session Id"
            },
            "description": "The unique identifier for a completed session."
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DiagnoseResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/v1/ask": {
      "post": {
        "tags": [
          "Stateless"
        ],
        "summary": "Ask",
        "operationId": "ask",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StatelessAskRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StatelessAskResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/v1/diagnose": {
      "post": {
        "tags": [
          "Stateless"
        ],
        "summary": "Diagnose",
        "operationId": "diagnose",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/StatelessAskRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StatelessDiagnoseResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "AnswerQuestionRequest": {
        "properties": {
          "question_id": {
            "type": "string",
            "title": "Question Id",
            "description": "The ID of the question being answered.",
            "examples": [
              1
            ]
          },
          "input": {
            "type": "string",
            "title": "Input",
            "description": "Free-text input from the user.",
            "examples": [
              "No, but i find it difficult to sleep at night"
            ]
          }
        },
        "type": "object",
        "required": [
          "question_id"
        ],
        "title": "AnswerQuestionRequest",
        "description": "Payload to submit patient response and get the next question."
      },
      "CodingSystem": {
        "type": "string",
        "enum": [
          "aut"
        ],
        "title": "CodingSystem",
        "description": "Medical coding system enumeration.\n\nRepresents the standardized medical terminology/coding system\nused to identify medical concepts.\n\nSystems:\n    ICD_10_CM: International Classification of Diseases, 10th Revision, Clinical Modification\n    ICD_10_AM: International Classification of Diseases, 10th Revision, Australian Modification\n    SNOMED_CT: Systematized Nomenclature of Medicine - Clinical Terms\n    AUT: Avey Universal Terminology (custom system)"
      },
      "Concept": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id",
            "description": "The unique identifier of the concept in its coding system.",
            "examples": [
              "Headache",
              "Fever"
            ]
          },
          "term": {
            "type": "string",
            "title": "Term",
            "description": "The human-readable name of the concept.",
            "examples": [
              "Headache",
              "Fever"
            ]
          }
        },
        "type": "object",
        "required": [
          "id",
          "term"
        ],
        "title": "Concept",
        "description": "Medical concept value object (symptom, sign, condition, or disease).\n\nImmutable value object defined by id and term attributes."
      },
      "DiagnoseResponse": {
        "properties": {
          "differential_diagnosis": {
            "items": {
              "$ref": "#/components/schemas/Disease"
            },
            "type": "array",
            "title": "Differential Diagnosis",
            "description": "A ranked list of possible conditions matching the patient's profile.",
            "examples": [
              [
                {
                  "description": "Commonly known as the common cold, this is a viral infection of your nose and throat.",
                  "id": "Common Cold",
                  "term": "Common Cold"
                },
                {
                  "description": "Commonly known as the flu, this is a contagious respiratory illness caused by influenza viruses.",
                  "id": "Influenza",
                  "term": "Influenza"
                }
              ]
            ]
          },
          "self_management": {
            "type": "string",
            "title": "Self Management",
            "description": "Advice for managing symptoms at home.",
            "examples": [
              "Stay hydrated and get plenty of rest. Over-the-counter pain relievers can help with aches."
            ]
          },
          "urgency": {
            "type": "string",
            "title": "Urgency",
            "description": "A high-level indicator of the situation's urgency",
            "examples": [
              "Home Treatable",
              "Non-Urgent, but schedule a visit with your physician",
              "Urgent, seek medical care and watch your symptoms closely",
              "Emergency, seek medical care immediately"
            ]
          },
          "specialist": {
            "type": "string",
            "title": "Specialist",
            "description": "recommended specialist for the patient to visit",
            "examples": [
              "General Practitioner"
            ]
          },
          "patient_info": {
            "$ref": "#/components/schemas/PatientInfo"
          }
        },
        "type": "object",
        "required": [
          "differential_diagnosis",
          "self_management",
          "urgency",
          "specialist",
          "patient_info"
        ],
        "title": "DiagnoseResponse",
        "description": "Clinical diagnosis of a patient."
      },
      "Disease": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id",
            "description": "The unique identifier of the concept in its coding system.",
            "examples": [
              "Headache",
              "Fever"
            ]
          },
          "term": {
            "type": "string",
            "title": "Term",
            "description": "The human-readable name of the concept.",
            "examples": [
              "Headache",
              "Fever"
            ]
          },
          "description": {
            "title": "Description",
            "description": "A clinical description of the disease.",
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ]
          }
        },
        "type": "object",
        "required": [
          "id",
          "term"
        ],
        "title": "Disease",
        "description": "Disease entity for differential diagnosis lists.\n\nExtends Concept with optional clinical description."
      },
      "Finding": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id",
            "description": "The unique identifier of the concept in its coding system.",
            "examples": [
              "Headache",
              "Fever"
            ]
          },
          "term": {
            "type": "string",
            "title": "Term",
            "description": "The human-readable name of the concept.",
            "examples": [
              "Headache",
              "Fever"
            ]
          },
          "status": {
            "$ref": "#/components/schemas/FindingStatus",
            "description": "The lowercased status of the finding as reported by the patient.",
            "examples": [
              "present",
              "absent",
              "unsure"
            ]
          }
        },
        "type": "object",
        "required": [
          "id",
          "term",
          "status"
        ],
        "title": "Finding",
        "description": "Medical finding value object (concept + status).\n\nImmutable value object representing a symptom/sign with presence status."
      },
      "FindingStatus": {
        "type": "string",
        "enum": [
          "present",
          "absent",
          "unsure"
        ],
        "title": "FindingStatus",
        "description": "Finding status: present, absent, or unsure (three-valued logic)."
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "PatientInfo": {
        "properties": {
          "age": {
            "type": "integer",
            "maximum": 130,
            "minimum": 0,
            "title": "Age",
            "description": "The age of the patient in years.",
            "examples": [
              34
            ]
          },
          "sex": {
            "$ref": "#/components/schemas/Sex",
            "description": "The biological sex of the patient. Possible values are 'male', 'female'."
          },
          "chief_findings": {
            "items": {
              "$ref": "#/components/schemas/Finding"
            },
            "type": "array",
            "title": "Chief Findings",
            "description": "The class Finding representation for chief_findings",
            "examples": [
              [
                {
                  "id": "Headache",
                  "status": "present",
                  "term": "Headache"
                },
                {
                  "id": "Fever",
                  "status": "present",
                  "term": "Fever"
                }
              ],
              [
                {
                  "id": "Insomnia",
                  "status": "present",
                  "term": "Insomnia"
                },
                {
                  "id": "Irritability",
                  "status": "present",
                  "term": "Irritability"
                }
              ]
            ]
          },
          "findings": {
            "items": {
              "$ref": "#/components/schemas/Finding"
            },
            "type": "array",
            "title": "Findings",
            "description": "The class Finding representation for findings",
            "examples": [
              [
                {
                  "id": "Headache",
                  "status": "present",
                  "term": "Headache"
                },
                {
                  "id": "Fever",
                  "status": "present",
                  "term": "Fever"
                },
                {
                  "id": "Nasal block",
                  "status": "absent",
                  "term": "Nasal block"
                },
                {
                  "id": "Headache (Occipital region)",
                  "status": "unsure",
                  "term": "Headache (Occipital region)"
                }
              ]
            ]
          }
        },
        "type": "object",
        "required": [
          "age",
          "sex",
          "chief_findings",
          "findings"
        ],
        "title": "PatientInfo",
        "description": "Final patient information for API responses.\n\nRepresents patient with demographics and findings as Finding objects for external consumption."
      },
      "Question": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id",
            "description": "A unique, incrementally increasing ID for the question within the session.",
            "examples": [
              1,
              2,
              3
            ]
          },
          "text": {
            "type": "string",
            "title": "Text",
            "description": "The question to be displayed to the user.",
            "examples": [
              "Do you have a Lymphadenopathy?"
            ]
          },
          "description": {
            "title": "Description",
            "description": "A statement that clarifies the question to an end user",
            "examples": [
              "Lymphadenopathy is enlargement or swelling in one of your lymph nodes"
            ],
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ]
          },
          "target_concepts": {
            "items": {
              "$ref": "#/components/schemas/Concept"
            },
            "type": "array",
            "title": "Target Concepts",
            "description": "The medical concept this question is about.",
            "examples": [
              [
                {
                  "id": "Headache (Occipital region)",
                  "term": "Headache (Occipital region)"
                },
                {
                  "id": "Headache (Occipital region)",
                  "term": "Headache (Occipital region)"
                }
              ]
            ]
          },
          "other_context": {
            "title": "Other Context",
            "description": "Additional context to the question, e.g. media_url.",
            "oneOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ]
          }
        },
        "type": "object",
        "required": [
          "id",
          "text",
          "target_concepts"
        ],
        "title": "Question",
        "description": "Diagnostic question entity.\n\nClinical inquiry about specific medical concepts to gather patient information."
      },
      "QuestionWithoutId": {
        "properties": {
          "text": {
            "type": "string",
            "title": "Text",
            "description": "The question to be displayed to the user.",
            "examples": [
              "Do you have a Lymphadenopathy?"
            ]
          },
          "description": {
            "title": "Description",
            "description": "A statement that clarifies the question to an end user",
            "examples": [
              "Lymphadenopathy is enlargement or swelling in one of your lymph nodes"
            ],
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ]
          },
          "target_concepts": {
            "items": {
              "$ref": "#/components/schemas/Concept"
            },
            "type": "array",
            "title": "Target Concepts",
            "description": "The medical concept this question is about.",
            "examples": [
              [
                {
                  "id": "Headache (Occipital region)",
                  "term": "Headache (Occipital region)"
                },
                {
                  "id": "Headache (Occipital region)",
                  "term": "Headache (Occipital region)"
                }
              ]
            ]
          },
          "other_context": {
            "title": "Other Context",
            "description": "Additional context to the question, e.g. media_url.",
            "oneOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ]
          }
        },
        "type": "object",
        "required": [
          "text",
          "target_concepts"
        ],
        "title": "QuestionWithoutId",
        "description": "Question variant with ID excluded from JSON schema (for stateless API responses)."
      },
      "SessionResponse": {
        "properties": {
          "status": {
            "$ref": "#/components/schemas/SessionStatus",
            "description": "The current state of the session",
            "examples": [
              "in_progress",
              "done"
            ]
          },
          "session_id": {
            "type": "string",
            "title": "Session Id",
            "description": "The unique identifier for the newly created session.",
            "examples": [
              "f47ac10b-58cc-4372-a567-0e02b2c3d479"
            ]
          },
          "question": {
            "description": "The question to be displayed to the user. Null if the session is done.",
            "oneOf": [
              {
                "$ref": "#/components/schemas/Question"
              },
              {
                "type": "null"
              }
            ]
          },
          "patient_info": {
            "$ref": "#/components/schemas/PatientInfo"
          }
        },
        "type": "object",
        "required": [
          "status",
          "session_id",
          "question",
          "patient_info"
        ],
        "title": "SessionResponse",
        "description": "Response from session operations (start or update).\n\nContains session ID, status, current question, and patient information."
      },
      "SessionStatus": {
        "type": "string",
        "enum": [
          "in_progress",
          "done"
        ],
        "title": "SessionStatus",
        "description": "Session progress status (in_progress or done)."
      },
      "Sex": {
        "type": "string",
        "enum": [
          "male",
          "female"
        ],
        "title": "Sex",
        "description": "Biological sex enumeration (male/female)."
      },
      "StartSessionRequest": {
        "properties": {
          "age": {
            "type": "integer",
            "maximum": 130,
            "exclusiveMinimum": 0,
            "title": "Age",
            "description": "The age of the patient in years.",
            "examples": [
              34
            ]
          },
          "sex": {
            "$ref": "#/components/schemas/Sex",
            "description": "The biological sex of the patient. Possible values are 'male', 'female'."
          },
          "input": {
            "type": "string",
            "title": "Input",
            "description": "Free-text input describing the patient's symptoms.",
            "examples": [
              "My tummy hurts, and i feel like i don't want to eat anything"
            ]
          },
          "max_questions": {
            "type": "integer",
            "title": "Max Questions",
            "description": "Maximum number of questions per session.",
            "default": 15
          }
        },
        "type": "object",
        "required": [
          "age",
          "sex",
          "input"
        ],
        "title": "StartSessionRequest",
        "description": "Request to start a new diagnostic session.\n\nIncludes patient demographics, symptom description, and session limits."
      },
      "StatelessAskRequest": {
        "properties": {
          "sex": {
            "$ref": "#/components/schemas/Sex"
          },
          "age": {
            "type": "integer",
            "maximum": 130,
            "exclusiveMinimum": 0,
            "title": "Age"
          },
          "coding": {
            "$ref": "#/components/schemas/CodingSystem",
            "default": "aut"
          },
          "chief_findings": {
            "items": {
              "$ref": "#/components/schemas/Concept"
            },
            "type": "array",
            "minItems": 1,
            "title": "Chief Findings",
            "description": "The main complaints of the patient which are found as present"
          },
          "findings": {
            "items": {
              "$ref": "#/components/schemas/Finding"
            },
            "type": "array",
            "title": "Findings",
            "description": "The findings found in the patient case and their presence. Present (patient confirms the finding), Absent (patient does not have the finding) Unsure (patient is uncertain of having it)"
          }
        },
        "type": "object",
        "required": [
          "sex",
          "age",
          "chief_findings",
          "findings"
        ],
        "title": "StatelessAskRequest",
        "description": "Request for stateless question generation.\n\nProvides patient demographics and findings without session tracking."
      },
      "StatelessAskResponse": {
        "properties": {
          "question": {
            "description": "The question to be displayed to the user in a non interactive session. Null if a question cannot be found.",
            "oneOf": [
              {
                "$ref": "#/components/schemas/QuestionWithoutId"
              },
              {
                "type": "null"
              }
            ]
          }
        },
        "type": "object",
        "required": [
          "question"
        ],
        "title": "StatelessAskResponse",
        "description": "Response from stateless question generation.\n\nContains generated question or None if unavailable."
      },
      "StatelessDiagnoseResponse": {
        "properties": {
          "ddx": {
            "items": {
              "$ref": "#/components/schemas/Disease"
            },
            "type": "array",
            "title": "Differential Diagnosis",
            "description": "A ranked list of possible conditions matching the patient's profile.",
            "examples": [
              [
                {
                  "description": "Commonly known as the common cold, this is a viral infection of your nose and throat.",
                  "id": "123",
                  "term": "Common Cold"
                },
                {
                  "description": "Commonly known as the flu, this is a contagious respiratory illness caused by influenza viruses.",
                  "id": "456",
                  "term": "Influenza"
                }
              ]
            ]
          }
        },
        "type": "object",
        "required": [
          "ddx"
        ],
        "title": "StatelessDiagnoseResponse",
        "description": "Response from stateless differential diagnosis generation.\n\nContains ranked list of potential diseases."
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "type": "array",
            "title": "Location"
          },
          "msg": {
            "type": "string",
            "title": "Message"
          },
          "type": {
            "type": "string",
            "title": "Error Type"
          }
        },
        "type": "object",
        "required": [
          "loc",
          "msg",
          "type"
        ],
        "title": "ValidationError"
      }
    },
    "securitySchemes": {
      "HTTPBearer": {
        "type": "http",
        "scheme": "bearer"
      }
    }
  }
}