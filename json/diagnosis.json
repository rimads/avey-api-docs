{
  "openapi": "3.1.0",
  "info": {
    "title": "Avey Diagnostic API",
    "description": "Use our leading symptom checker AI to provide early patient care through differential diagnosis suggestions, self-management advice, specialist recommendation, and a triage assessment of how urgent the patient's presentation is",
    "version": "0.1.0"
  },
  "servers": [
    {
      "url": "https://api.avey.ai/ddx",
      "description": "Production"
    }
  ],
  "paths": {
    "/diagnosis/": {
      "post": {
        "tags": ["New Diagnosis"],
        "summary": "Create a clinical diagnosis",
        "description": "generates a clinical diagnosis and patient recommendations based on a patient's profile.\n    Query parameters can be used to toggle:\n        * Differential Diagnosis\n        * Urgency (Triage)\n        * Specialist Recommendation\n        * Suggested Health Management Advice",
        "operationId": "diagnose",
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "parameters": [
          {
            "name": "differential",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "description": "If true, generates and returns a differential diagnosis list.",
              "default": true,
              "title": "Differential"
            },
            "description": "If true, generates and returns a differential diagnosis list."
          },
          {
            "name": "self_management",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "description": "If true, provides advice for managing symptoms at home.",
              "default": true,
              "title": "Self Management"
            },
            "description": "If true, provides advice for managing symptoms at home."
          },
          {
            "name": "urgency",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "description": "If true, assesses the urgency level of the situation.",
              "default": true,
              "title": "Urgency"
            },
            "description": "If true, assesses the urgency level of the situation."
          },
          {
            "name": "specialist",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "description": "If true, recommends a medical specialist to consult.",
              "default": true,
              "title": "Specialist"
            },
            "description": "If true, recommends a medical specialist to consult."
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DiagnoseRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful clinical assessment.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DiagnoseResponse"
                }
              }
            }
          },
          "401": {
            "description": "Invalid or missing authentication token.",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Not authenticated"
                }
              }
            }
          },
          "422": {
            "description": "Validation error: the request body is malformed.",
            "content": {
              "application/json": {
                "example": {
                  "detail": [
                    {
                      "loc": ["body", "patient_info", "age"],
                      "msg": "Input should be a valid integer",
                      "type": "int_parsing"
                    }
                  ]
                }
              }
            }
          },
          "500": {
            "description": "Internal server error.",
            "content": {
              "application/json": {
                "example": {
                  "detail": "An unexpected internal error occurred."
                }
              }
            }
          }
        }
      }
    },
    "/session/": {
      "post": {
        "tags": ["Session management"],
        "summary": "Create a new session",
        "description": "Starts a new interactive diagnostic session. provide the patient's initial information\n    (age, sex, and the input text of the patient) to create a session and receive the first question.\n    A unique `session_id` is returned, which you must use for all subsequent calls.",
        "operationId": "create_session",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NewSessionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Session successfully created and first question returned.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NewSessionResponse"
                }
              }
            }
          },
          "401": {
            "description": "Invalid or missing authentication token.",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Not authenticated"
                }
              }
            }
          },
          "422": {
            "description": "Validation error.",
            "content": {
              "application/json": {
                "examples": {
                  "missing_input": {
                    "summary": "Missing input",
                    "value": {
                      "detail": "Either 'input_text' or 'chief_findings_codes' must be provided."
                    }
                  },
                  "extraction_failure": {
                    "summary": "Extraction failure",
                    "value": {
                      "detail": "Could not extract any chief findings from the provided 'input_text'."
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error.",
            "content": {
              "application/json": {
                "example": {
                  "detail": "An unexpected internal error occurred."
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/session/{session_id}": {
      "post": {
        "tags": ["Session management"],
        "summary": "Update a session",
        "description": "Submits an answer to the previous question and retrieves the next one.\n    When the model has enough information, or if the question limit set for the session is reached, the `question` field in the response will be `null`.",
        "operationId": "update_session",
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "parameters": [
          {
            "name": "session_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "description": "The unique identifier for the session.",
              "examples": ["f47ac10b-58cc-4372-a567-0e02b2c3d479"],
              "title": "Session Id"
            },
            "description": "The unique identifier for the session."
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateSessionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Answer processed successfully. Returns next question or null.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UpdateSessionResponse"
                }
              }
            }
          },
          "401": {
            "description": "Invalid or missing authentication token.",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Not authenticated"
                }
              }
            }
          },
          "404": {
            "description": "Session not found.",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Session not found or has expired."
                }
              }
            }
          },
          "422": {
            "description": "Validation error.",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Could not extract answers from raw text or object input"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error.",
            "content": {
              "application/json": {
                "example": {
                  "detail": "An unexpected internal error occurred."
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "CodingType": {
        "type": "string",
        "enum": ["icd-10-cm", "snomed-ct", "aut"],
        "title": "CodingType",
        "description": "Specifies the medical coding system used for documenting patient findings. Avey Unified Terminology (aut) is our internally developed naming system designed to be simple for developers to work with while remaining medically expressive. It uses unique strings for each name, making it convenient to use the name as the term's identifier."
      },
      "Concept": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id",
            "description": "The unique identifier of the concept in its coding system.",
            "examples": ["Headache", "Fever"]
          },
          "term": {
            "type": "string",
            "title": "Term",
            "description": "The human-readable name of the concept.",
            "examples": ["Headache", "Fever"]
          }
        },
        "type": "object",
        "required": ["id", "term"],
        "title": "Concept",
        "description": "Represents a general medical concept, like a symptom or condition."
      },
      "DiagnoseRequest": {
        "properties": {
          "patient_info": {
            "$ref": "#/components/schemas/PatientInfo-Input",
            "description": "The complete patient profile",
            "examples": [
              {
                "age": 34,
                "chief_findings": [
                  {
                    "id": "Headache",
                    "status": "present",
                    "term": "Headache"
                  }
                ],
                "findings": [
                  {
                    "id": "Fever",
                    "status": "present",
                    "term": "Fever"
                  },
                  {
                    "id": "Cough",
                    "status": "absent",
                    "term": "Cough"
                  }
                ],
                "sex": "female"
              }
            ]
          }
        },
        "type": "object",
        "required": ["patient_info"],
        "title": "DiagnoseRequest",
        "description": "Request the clinical diagnosis of a patient profile."
      },
      "DiagnoseResponse": {
        "properties": {
          "differential_diagnosis": {
            "anyOf": [
              {
                "items": {
                  "$ref": "#/components/schemas/Disease"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Differential Diagnosis",
            "description": "A ranked list of possible conditions matching the patient's profile.",
            "examples": [
              [
                {
                  "description": "Commonly known as the common cold, this is a viral infection of your nose and throat.",
                  "id": "Common Cold",
                  "note": "Often resolves on its own within 7-10 days.",
                  "term": "Common Cold",
                  "treatment": "Rest, fluids, and over-the-counter medications can help relieve symptoms."
                },
                {
                  "description": "Commonly known as the flu, this is a contagious respiratory illness caused by influenza viruses.",
                  "id": "Influenza",
                  "note": "Symptoms are typically more severe than a cold and can include fever, body aches, and fatigue.",
                  "term": "Influenza",
                  "treatment": "Antiviral drugs may be prescribed. Rest and fluid intake are crucial for recovery."
                }
              ]
            ]
          },
          "self_management": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Self Management",
            "description": "Advice for managing symptoms at home.",
            "examples": [
              "Stay hydrated and get plenty of rest. Over-the-counter pain relievers can help with aches."
            ]
          },
          "urgency": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Urgency",
            "description": "A high-level indicator of the situation's urgency",
            "examples": [
              "home treatable",
              "non-urgent, but schedule a visit with your physician",
              "urgent, seek medical care and watch your symptoms closely",
              "emergency, seek medical care immediately"
            ]
          },
          "specialist": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Specialist",
            "description": "recommended specialist for the patient to visit",
            "examples": ["General Practitioner"]
          }
        },
        "type": "object",
        "title": "DiagnoseResponse",
        "description": "Clinical diagnosis of a patient."
      },
      "Disease": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id",
            "description": "The unique identifier of the concept in its coding system.",
            "examples": ["Headache", "Fever"]
          },
          "term": {
            "type": "string",
            "title": "Term",
            "description": "The human-readable name of the concept.",
            "examples": ["Headache", "Fever"]
          },
          "description": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Description",
            "description": "A clinical description of the disease."
          },
          "note": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Note",
            "description": "Additional notes about the disease."
          },
          "treatment": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Treatment",
            "description": "General information about treatment options."
          }
        },
        "type": "object",
        "required": ["id", "term"],
        "title": "Disease",
        "description": "Detailed information about a potential disease or condition in a differential diagnosis."
      },
      "Finding": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id",
            "description": "The unique identifier of the concept in its coding system.",
            "examples": ["Headache", "Fever"]
          },
          "term": {
            "type": "string",
            "title": "Term",
            "description": "The human-readable name of the concept.",
            "examples": ["Headache", "Fever"]
          },
          "status": {
            "$ref": "#/components/schemas/FindingStatus",
            "description": "The lowercased status of the finding as reported by the patient.",
            "examples": ["present", "absent", "unsure"]
          }
        },
        "type": "object",
        "required": ["id", "term", "status"],
        "title": "Finding",
        "description": "A medical concept with a reported status from the patient."
      },
      "FindingAnswer": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id",
            "description": "The concept ID of the finding being answered.",
            "examples": ["Fever"]
          },
          "status": {
            "$ref": "#/components/schemas/FindingStatus"
          }
        },
        "type": "object",
        "required": ["id", "status"],
        "title": "FindingAnswer",
        "description": "An answer to a text-based question."
      },
      "FindingStatus": {
        "type": "string",
        "enum": ["present", "absent", "unsure"],
        "title": "FindingStatus",
        "description": "The patient's reported status for a given finding or symptom."
      },
      "NewSessionRequest": {
        "properties": {
          "coding_type": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/CodingType"
              },
              {
                "type": "null"
              }
            ],
            "description": "The desired coding system for all concepts in the session.",
            "default": "aut"
          },
          "max_questions": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Max Questions",
            "description": "The maximum number of questions the model should ask during the session. By default, the model automatically ends a session after takes on average around 10-20 questions."
          },
          "patient_info": {
            "$ref": "#/components/schemas/PatientInfoRequest"
          },
          "input_text": {
            "type": "string",
            "title": "Input Text",
            "description": "Free-text input describing the patient's symptoms.",
            "examples": [
              "My tummy hurts, and i feel like i don't want to eat anything"
            ]
          }
        },
        "type": "object",
        "required": ["patient_info"],
        "title": "NewSessionRequest",
        "description": "Payload to create a new diagnostic session."
      },
      "NewSessionResponse": {
        "properties": {
          "session_id": {
            "type": "string",
            "title": "Session Id",
            "description": "The unique identifier for the newly created session.",
            "examples": ["f47ac10b-58cc-4372-a567-0e02b2c3d479"]
          },
          "question": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/Question"
              },
              {
                "type": "null"
              }
            ]
          },
          "patient_info": {
            "$ref": "#/components/schemas/PatientInfo-Output"
          }
        },
        "type": "object",
        "required": ["session_id", "patient_info"],
        "title": "NewSessionResponse",
        "description": "Response from creating a new session, containing the first question."
      },
      "PatientInfo-Input": {
        "properties": {
          "age": {
            "type": "integer",
            "maximum": 130.0,
            "minimum": 0.0,
            "title": "Age",
            "description": "The age of the patient in years.",
            "examples": [34]
          },
          "sex": {
            "$ref": "#/components/schemas/Sex",
            "description": "The biological sex of the patient. Possible values are 'male', 'female'."
          },
          "chief_findings": {
            "items": {
              "$ref": "#/components/schemas/Finding"
            },
            "type": "array",
            "title": "Chief Findings",
            "description": "The primary symptoms or reasons for the consultation, all of which should have a present status",
            "examples": [
              [
                {
                  "id": "Headache",
                  "status": "present",
                  "term": "Headache"
                },
                {
                  "id": "Fever",
                  "status": "present",
                  "term": "Fever"
                }
              ],
              [
                {
                  "id": "Insomnia",
                  "status": "present",
                  "term": "Insomnia"
                },
                {
                  "id": "Irritability",
                  "status": "present",
                  "term": "Irritability"
                }
              ]
            ]
          },
          "findings": {
            "items": {
              "$ref": "#/components/schemas/Finding"
            },
            "type": "array",
            "title": "Findings",
            "description": "All symptoms or findings collected during the session.",
            "examples": [
              [
                {
                  "id": "Headache",
                  "status": "present",
                  "term": "Headache"
                },
                {
                  "id": "Fever",
                  "status": "present",
                  "term": "Fever"
                },
                {
                  "id": "Nasal block",
                  "status": "absent",
                  "term": "Nasal block"
                },
                {
                  "id": "Headache (Occipital region)",
                  "status": "unsure",
                  "term": "Headache (Occipital region)"
                }
              ]
            ]
          }
        },
        "type": "object",
        "required": ["age", "sex", "chief_findings", "findings"],
        "title": "PatientInfo",
        "description": "A complete snapshot of the patient's information at a point in time."
      },
      "PatientInfo-Output": {
        "properties": {
          "age": {
            "type": "integer",
            "maximum": 130.0,
            "minimum": 0.0,
            "title": "Age",
            "description": "The age of the patient in years.",
            "examples": [34]
          },
          "sex": {
            "$ref": "#/components/schemas/Sex",
            "description": "The biological sex of the patient. Possible values are 'male', 'female'."
          },
          "chief_findings": {
            "items": {
              "$ref": "#/components/schemas/Finding"
            },
            "type": "array",
            "title": "Chief Findings",
            "description": "The primary symptoms or reasons for the consultation, all of which should have a present status",
            "examples": [
              [
                {
                  "id": "Headache",
                  "status": "present",
                  "term": "Headache"
                },
                {
                  "id": "Fever",
                  "status": "present",
                  "term": "Fever"
                }
              ],
              [
                {
                  "id": "Insomnia",
                  "status": "present",
                  "term": "Insomnia"
                },
                {
                  "id": "Irritability",
                  "status": "present",
                  "term": "Irritability"
                }
              ]
            ]
          },
          "findings": {
            "items": {
              "$ref": "#/components/schemas/Finding"
            },
            "type": "array",
            "title": "Findings",
            "description": "All symptoms or findings collected during the session.",
            "examples": [
              [
                {
                  "id": "Headache",
                  "status": "present",
                  "term": "Headache"
                },
                {
                  "id": "Fever",
                  "status": "present",
                  "term": "Fever"
                },
                {
                  "id": "Nasal block",
                  "status": "absent",
                  "term": "Nasal block"
                },
                {
                  "id": "Headache (Occipital region)",
                  "status": "unsure",
                  "term": "Headache (Occipital region)"
                }
              ]
            ]
          }
        },
        "type": "object",
        "required": ["age", "sex", "chief_findings", "findings"],
        "title": "PatientInfo",
        "description": "A complete snapshot of the patient's information at a point in time."
      },
      "PatientInfoRequest": {
        "properties": {
          "age": {
            "type": "integer",
            "maximum": 130.0,
            "minimum": 0.0,
            "title": "Age",
            "description": "The age of the patient in years.",
            "examples": [34]
          },
          "sex": {
            "$ref": "#/components/schemas/Sex",
            "description": "The biological sex of the patient. Possible values are 'male', 'female'."
          }
        },
        "type": "object",
        "required": ["age", "sex"],
        "title": "PatientInfoRequest",
        "description": "initial patient information used to start a new session."
      },
      "Question": {
        "properties": {
          "id": {
            "type": "integer",
            "title": "Id",
            "description": "A unique, incrementally increasing ID for the question within the session.",
            "examples": [1, 2, 3]
          },
          "content": {
            "$ref": "#/components/schemas/TextQuestion",
            "description": "The content of the question"
          }
        },
        "type": "object",
        "required": ["id", "content"],
        "title": "Question",
        "description": "Container object for a question returned by the model."
      },
      "Sex": {
        "type": "string",
        "enum": ["male", "female"],
        "title": "Sex",
        "description": "Biological sex of the patient."
      },
      "TextQuestion": {
        "properties": {
          "type": {
            "type": "string",
            "const": "text",
            "title": "Type",
            "description": "The type of question"
          },
          "text": {
            "type": "string",
            "title": "Text",
            "description": "The question to be displayed to the user.",
            "examples": ["Do you have a headache?"]
          },
          "target_concept": {
            "$ref": "#/components/schemas/Concept",
            "description": "The medical concept this question is about.",
            "examples": [
              {
                "id": "Headache (Occipital region)",
                "status": "unsure",
                "term": "Headache (Occipital region)"
              }
            ]
          }
        },
        "type": "object",
        "required": ["type", "text", "target_concept"],
        "title": "TextQuestion",
        "description": "A standard text-based question targeting a specific medical concept."
      },
      "UpdateSessionRequest": {
        "properties": {
          "question_id": {
            "type": "integer",
            "title": "Question Id",
            "description": "The ID of the question being answered.",
            "examples": [1]
          },
          "answers": {
            "anyOf": [
              {
                "items": {
                  "$ref": "#/components/schemas/FindingAnswer"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Answers",
            "description": "A list of answers for text-based questions. Either this object or input_text must be provided",
            "examples": [
              [
                {
                  "id": "Headache",
                  "status": "present"
                }
              ]
            ]
          },
          "input_text": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Input Text",
            "description": "Free-text input from the user. Either this or an answers object must be provided",
            "examples": ["No, but i find it difficult to sleep at night"]
          }
        },
        "type": "object",
        "required": ["question_id"],
        "title": "UpdateSessionRequest",
        "description": "Payload to submit answers and get the next question."
      },
      "UpdateSessionResponse": {
        "properties": {
          "question": {
            "anyOf": [
              {
                "$ref": "#/components/schemas/Question"
              },
              {
                "type": "null"
              }
            ],
            "description": "The next question to ask. If null, the interview phase is complete."
          },
          "patient_info": {
            "$ref": "#/components/schemas/PatientInfo-Output",
            "description": "An updated snapshot of the patient's information after the model process new findings. The model may add new concepts by medically supported inductive reasoning. For example, if menstruation is found to be present. The model may add pregnancy to be absent depending on the patient case.",
            "examples": [
              {
                "patient_info": {
                  "age": 34,
                  "chief_findings": [
                    {
                      "id": "Headache",
                      "status": "present",
                      "term": "Headache"
                    }
                  ],
                  "findings": [
                    {
                      "id": "Fever",
                      "status": "present",
                      "term": "Fever"
                    },
                    {
                      "id": "Cough",
                      "status": "absent",
                      "term": "Cough"
                    }
                  ],
                  "sex": "female"
                }
              }
            ]
          }
        },
        "type": "object",
        "required": ["patient_info"],
        "title": "UpdateSessionResponse",
        "description": "Response to an answer submission. contains either the next question or null.\nWhen 'question' is null, the session is over. the client should then copy the returned\n'patient_info' and use it to make a final call to the defined diagnosis endpoint."
      }
    },
    "securitySchemes": {
      "HTTPBearer": {
        "type": "http",
        "scheme": "bearer"
      }
    }
  }
}
